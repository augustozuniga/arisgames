<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Sun, 24 Oct 2010 02:44:09 +0000">

<link rel="stylesheet" type="text/css" href="../stylesheet.css">
<link rel="start" href="../overview-summary.html">

<title>collectedItems.php (ARIS Server)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>ARIS Server</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source/collecteditems.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>collectedItems.php</h1>
<hr>

<a name="line1"></a><pre><?php
<a name="line2"></a>
<a name="line3"></a>require_once('config.class.php');
<a name="line4"></a>require_once('media.php');
<a name="line5"></a>
<a name="line6"></a>$conn = mysql_pconnect(Config::dbHost, Config::dbUser, Config::dbPass);
<a name="line7"></a>mysql_select_db (Config::dbSchema);
<a name="line8"></a>$prefix = $_REQUEST['gameId'];
<a name="line9"></a>$query = "SELECT {$prefix}_items.*, media.*, players.*
<a name="line10"></a>			FROM {$prefix}_items, media, players
<a name="line11"></a>			WHERE {$prefix}_items.media_id = media.media_id AND {$prefix}_items.creator_player_id = players.player_id";
<a name="line12"></a>$result = @mysql_query($query);
<a name="line13"></a>
<a name="line14"></a>if (mysql_error()) die ("<html><body>ERROR: Bad gameId</body></html>");
<a name="line15"></a>
<a name="line16"></a>
<a name="line17"></a>// Creates an array of strings to hold the lines of the KML file.
<a name="line18"></a>$kml = array('<?xml version="1.0" encoding="UTF-8"?>');
<a name="line19"></a>$kml[] = '<kml xmlns="http://earth.google.com/kml/2.1">';
<a name="line20"></a>$kml[] = ' <Document>';
<a name="line21"></a>
<a name="line22"></a>
<a name="line23"></a>// Iterates through the rows, printing a node for each row.
<a name="line24"></a>while ($row = @mysql_fetch_assoc($result)) 
<a name="line25"></a>{
<a name="line26"></a>  $kml[] = ' <Placemark id="placemark' . $row['item_id'] . '">';
<a name="line27"></a>  $kml[] = ' <name>' . htmlentities($row['name']) . '</name>';
<a name="line28"></a>  
<a name="line29"></a>  $mediaURL = Config::gamedataWWWPath . "/{$_REQUEST['gameId']}/{$row['file_name']}";
<a name="line30"></a>  
<a name="line31"></a>  $mediaObject = new Media;
<a name="line32"></a>  $type = $mediaObject->getMediaType($mediaURL);
<a name="line33"></a>  
<a name="line34"></a>  if ($type == Media::MEDIA_IMAGE) $mediaHtml = "<a target = '_blank' href = '{$mediaURL}'><img src = '$mediaURL' width = '100%'/></a>";
<a name="line35"></a>  else if ($type == Media::MEDIA_AUDIO) $mediaHtml = "<a target = '_blank' href = '{$mediaURL}'>Link to Audio</a>"; 
<a name="line36"></a>  else if ($type == Media::MEDIA_VIDEO) $mediaHtml = '<div style="margin-left: auto; margin-right:auto;">
<a name="line37"></a>              <object height="175" width="212">
<a name="line38"></a>                <param value="' . $mediaURL . '" name="movie">
<a name="line39"></a>                <param value="transparent" name="wmode">
<a name="line40"></a>                <embed wmode="transparent" type="application/x-shockwave-flash"
<a name="line41"></a>                   src="'.$mediaURL.'" height="175"
<a name="line42"></a>                   width="212">
<a name="line43"></a>               </object>
<a name="line44"></a>             </div>';
<a name="line45"></a>
<a name="line46"></a>/*
<a name="line47"></a><![CDATA[<div style="font-size:larger">
<a name="line48"></a>          <div>
<a name="line49"></a>            <div style="width: 212px; font-size: 12px;">
<a name="line50"></a>              <b>The Spaghetti Film</b>
<a name="line51"></a>            </div>
<a name="line52"></a>            <div style="font-size: 11px;">
<a name="line53"></a>              <a target="_blank" href="http://www.youtube.com/?v=FICUvrVlyXc">
<a name="line54"></a>                http://www.youtube.com/?v=FICUvrVlyXc</a><br>
<a name="line55"></a>            </div><br>
<a name="line56"></a>            <div style="margin-left: auto; margin-right:auto;">
<a name="line57"></a>              <object height="175" width="212">
<a name="line58"></a>                <param value="http://www.youtube.com/v/FICUvrVlyXc" name="movie">
<a name="line59"></a>                <param value="transparent" name="wmode">
<a name="line60"></a>                <embed wmode="transparent" type="application/x-shockwave-flash"
<a name="line61"></a>                   src="http://www.youtube.com/v/FICUvrVlyXc" height="175"
<a name="line62"></a>                   width="212">
<a name="line63"></a>               </object>
<a name="line64"></a>             </div>
<a name="line65"></a>           </div>
<a name="line66"></a>          </div>
<a name="line67"></a>          <div style="font-size: smaller; margin-top: 1em;">Saved from 
<a name="line68"></a>            <a href="http://maps.google.com/ig/add?synd=mpl&pid=mpl&moduleurl=
<a name="line69"></a>                http:%2F%2Fwww.google.com%2Fig%2Fmodules%2Fmapplets-youtube.xml&hl=en&gl=us">
<a name="line70"></a>                YouTubeVideos</a>
<a name="line71"></a>          </div>
<a name="line72"></a>         ]]>
<a name="line73"></a>
<a name="line74"></a>  */
<a name="line75"></a>  
<a name="line76"></a>            
<a name="line77"></a>  
<a name="line78"></a>  $description = array("<![CDATA[");
<a name="line79"></a>  $description[] = "<strong>Created By:</strong> {$row['user_name']}<br/>";
<a name="line80"></a>  $description[] = "<strong>Date:</strong> {$row['origin_timestamp']}<br/>";
<a name="line81"></a>  $description[] = '<p>' . htmlentities($row['description']) . '</p>';
<a name="line82"></a>  $description[] = $mediaHtml;
<a name="line83"></a>  $description[] = "]]>";
<a name="line84"></a>  $descriptionHtml = join("\n", $description);
<a name="line85"></a>  
<a name="line86"></a>  $kml[] = ' <description>' . $descriptionHtml . '</description>';
<a name="line87"></a>  $kml[] = ' <Point>';
<a name="line88"></a>  $kml[] = ' <coordinates>' . $row['origin_longitude'] . ','  . $row['origin_latitude'] . '</coordinates>';
<a name="line89"></a>  $kml[] = ' </Point>';
<a name="line90"></a>  $kml[] = ' </Placemark>';
<a name="line91"></a> 
<a name="line92"></a>} 
<a name="line93"></a>
<a name="line94"></a>// End XML file
<a name="line95"></a>$kml[] = ' </Document>';
<a name="line96"></a>$kml[] = '</kml>';
<a name="line97"></a>$kmlOutput = join("\n", $kml);
<a name="line98"></a>header('Content-type: application/vnd.google-earth.kml+xml');
<a name="line99"></a>header('Content-Disposition: attachment; filename="ARISGame.kml"');
<a name="line100"></a>echo $kmlOutput;
<a name="line101"></a>
<a name="line102"></a>
<a name="line103"></a>?></pre>
<div class="header">
<h1>ARIS Server</h1>
<ul>
<li><a href="../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../overview-files.html">Files</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../todo-list.html">Todo</a></li>
<li><a href="../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../index.html" target="_top">Frames</a>
<a href="../source/collecteditems.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>